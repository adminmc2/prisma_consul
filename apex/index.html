<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="APEX - Automatización de Procesos y Experiencias. Cuéntanos qué te duele y diseñamos tu sistema único.">

  <title>APEX | Formulario de Descubrimiento</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="../images/favicon.svg">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&family=Source+Sans+3:wght@300;400;600&display=swap" rel="stylesheet">

  <!-- Phosphor Icons (local) -->
  <link rel="stylesheet" href="fonts/phosphor.css">

  <!-- Styles -->
  <link rel="stylesheet" href="form.css">
</head>
<body>
  <!-- Progress Bar -->
  <div class="progress-bar">
    <div class="progress-bar__fill" id="progressFill"></div>
  </div>


  <!-- Container principal del formulario -->
  <main class="form-container" id="formContainer">

    <!-- ==================== PANTALLA DE BIENVENIDA ==================== -->
    <section class="form-screen active" data-screen="welcome">
      <div class="screen-content">
        <div class="welcome-logo">
          <img src="../images/logo-completo-transparente.svg" alt="PRISMA Consulting">
        </div>
        <h1 class="welcome-title">Descubre APEX</h1>
        <p class="welcome-subtitle">
          <strong>A</strong>utomatización de <strong>P</strong>rocesos y <strong>EX</strong>periencias.<br>
          Cuéntanos qué te duele y diseñamos tu sistema único.
        </p>
        <div class="welcome-time">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
          <span>5-7 minutos</span>
        </div>
        <button class="btn-primary btn-start" id="btnStart">
          <span>Empezar</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- ==================== FASE 0: IDENTIFICACIÓN DE EMPRESA ==================== -->

    <!-- Pregunta 0: Empresa -->
    <section class="form-screen" data-screen="q0-company" data-phase="0">
      <div class="screen-content">
        <h2 class="question-title">¿De qué empresa vienes?</h2>
        <p class="question-hint">Escribe el nombre de tu empresa o su sitio web para personalizar las preguntas</p>

        <div class="company-input-wrapper">
          <input
            type="text"
            id="companyInput"
            class="company-input"
            placeholder="ej: Laboratorios Pharmax o pharmax.com.mx"
            autocomplete="organization"
          >
          <button class="btn-primary btn-research" id="btnResearchCompany">
            <span>Continuar</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </button>
        </div>

        <p class="company-hint">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 16v-4M12 8h.01"/>
          </svg>
          Esto nos ayuda a hacer preguntas más relevantes para tu industria
        </p>
      </div>
    </section>

    <!-- Pantalla: Investigando empresa -->
    <section class="form-screen" data-screen="researching-company">
      <div class="screen-content">
        <!-- Estado: Buscando -->
        <div id="researchSearching">
          <div class="research-header">
            <div class="research-icon">
              <div class="loading-search">
                <svg viewBox="0 0 60 60" fill="none">
                  <circle cx="26" cy="26" r="18" stroke="currentColor" stroke-width="3" opacity="0.3"/>
                  <circle class="search-circle" cx="26" cy="26" r="18" stroke="currentColor" stroke-width="3"/>
                  <line x1="40" y1="40" x2="52" y2="52" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                </svg>
              </div>
            </div>
            <h2 class="research-title">Investigando tu empresa...</h2>
          </div>

          <div class="research-info">
            <p class="research-description">
              Estamos buscando información pública sobre tu empresa para hacerte preguntas más relevantes.
            </p>

            <div class="research-benefits">
              <div class="research-benefit">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                <span>Personalizamos las preguntas a tu industria</span>
              </div>
              <div class="research-benefit">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                <span>Identificamos dolores comunes en empresas similares</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Estado: Resultados encontrados -->
        <div id="researchResults" style="display: none;">
          <div class="research-header">
            <div class="research-icon research-icon-done">
              <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
              </svg>
            </div>
            <h2 class="research-title">Esto es lo que encontramos</h2>
          </div>

          <div class="research-findings">
            <div class="finding-card">
              <div class="finding-label">Empresa</div>
              <div class="finding-value" id="findingName">-</div>
            </div>
            <div class="finding-card">
              <div class="finding-label">Sector</div>
              <div class="finding-value" id="findingSector">-</div>
            </div>
            <div class="finding-card finding-card-full">
              <div class="finding-label">Cómo operan</div>
              <div class="finding-value finding-description" id="findingDescription">-</div>
            </div>
            <div class="finding-card" id="findingFieldTeamCard" style="display: none;">
              <div class="finding-label">Equipo de campo</div>
              <div class="finding-value" id="findingFieldTeam">-</div>
            </div>
            <div class="finding-card" id="findingSamplesCard" style="display: none;">
              <div class="finding-label">Muestras médicas</div>
              <div class="finding-value" id="findingSamples">-</div>
            </div>
            <div class="finding-card finding-card-full" id="findingProcessesCard" style="display: none;">
              <div class="finding-label">Procesos detectados</div>
              <div class="finding-value finding-list" id="findingProcesses">-</div>
            </div>
            <div class="finding-card finding-card-full" id="findingSourcesCard" style="display: none;">
              <div class="finding-label">Fuentes</div>
              <div class="finding-value finding-sources" id="findingSources">-</div>
            </div>
          </div>

          <p class="research-note">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 16v-4M12 8h.01"/>
            </svg>
            <span id="researchConfidence">Información obtenida de fuentes públicas</span>
          </p>
        </div>

        <button class="btn-primary btn-continue-research" id="btnContinueResearch" disabled>
          <span>Buscando...</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- ==================== FASE 1: PREGUNTAS FIJAS ==================== -->

    <!-- Pregunta 1.1: Tamaño del equipo -->
    <section class="form-screen" data-screen="q1-1" data-phase="1">
      <div class="screen-content">
        <h2 class="question-title">¿Cuántas personas usarían el sistema?</h2>
        <p class="question-hint">Incluye representantes, supervisores y personal administrativo</p>

        <div class="options-list" data-question="team_size">
          <button class="option-btn" data-value="1-5">
            <span class="option-key">A</span>
            <span class="option-text">1-5 personas</span>
          </button>
          <button class="option-btn" data-value="6-15">
            <span class="option-key">B</span>
            <span class="option-text">6-15 personas</span>
          </button>
          <button class="option-btn" data-value="16-30">
            <span class="option-key">C</span>
            <span class="option-text">16-30 personas</span>
          </button>
          <button class="option-btn" data-value="30+">
            <span class="option-key">D</span>
            <span class="option-text">Más de 30 personas</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Pregunta 1.2: Equipo de campo -->
    <section class="form-screen" data-screen="q1-2" data-phase="1">
      <div class="screen-content">
        <h2 class="question-title">¿Tienes equipo que visita clientes en campo?</h2>
        <p class="question-hint">Representantes, vendedores, visitadores médicos, técnicos de servicio</p>

        <div class="options-list" data-question="has_field_team">
          <button class="option-btn" data-value="yes">
            <span class="option-key">A</span>
            <span class="option-text">Sí, tenemos equipo de campo</span>
          </button>
          <button class="option-btn" data-value="no">
            <span class="option-key">B</span>
            <span class="option-text">No, todo es desde oficina o remoto</span>
          </button>
          <button class="option-btn" data-value="both">
            <span class="option-key">C</span>
            <span class="option-text">Ambos (parte en campo, parte en oficina)</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Pregunta 1.3: Sector -->
    <section class="form-screen" data-screen="q1-3" data-phase="1">
      <div class="screen-content">
        <h2 class="question-title">¿En qué sector está tu empresa?</h2>

        <div class="options-list" data-question="sector">
          <button class="option-btn" data-value="pharma">
            <span class="option-key">A</span>
            <span class="option-text">Farmacéutico / Dispositivos médicos</span>
          </button>
          <button class="option-btn" data-value="distribution">
            <span class="option-key">B</span>
            <span class="option-text">Distribución / Mayorista</span>
          </button>
          <button class="option-btn" data-value="manufacturing">
            <span class="option-key">C</span>
            <span class="option-text">Manufactura / Producción</span>
          </button>
          <button class="option-btn" data-value="clinica">
            <span class="option-key">D</span>
            <span class="option-text">Clínica médica, estética o dental</span>
          </button>
          <button class="option-btn" data-value="retail">
            <span class="option-key">E</span>
            <span class="option-text">Retail / Comercio</span>
          </button>
          <button class="option-btn" data-value="other" data-has-input="true">
            <span class="option-key">F</span>
            <span class="option-text">Otro</span>
          </button>
        </div>

        <div class="other-input-container hidden" id="sectorOtherContainer">
          <input type="text" class="other-input" id="sectorOther" placeholder="Escribe tu sector...">
        </div>
      </div>
    </section>

    <!-- Pregunta 1.4: Tecnología actual -->
    <section class="form-screen" data-screen="q1-4" data-phase="1">
      <div class="screen-content">
        <h2 class="question-title">¿Cómo gestionas hoy la información de tu operación comercial?</h2>
        <p class="question-hint">Puedes seleccionar varias opciones</p>

        <div class="options-list multi-select" data-question="current_tech" data-multi="true">
          <button class="option-btn" data-value="excel">
            <span class="option-checkbox"></span>
            <span class="option-text">Excel / Google Sheets</span>
          </button>
          <button class="option-btn" data-value="crm">
            <span class="option-checkbox"></span>
            <span class="option-text">Un CRM (Salesforce, HubSpot, Zoho, otro)</span>
          </button>
          <button class="option-btn" data-value="erp">
            <span class="option-checkbox"></span>
            <span class="option-text">ERP con módulo comercial</span>
          </button>
          <button class="option-btn" data-value="informal">
            <span class="option-checkbox"></span>
            <span class="option-text">Libretas / WhatsApp / Email</span>
          </button>
          <button class="option-btn" data-value="nothing">
            <span class="option-checkbox"></span>
            <span class="option-text">No tenemos nada centralizado</span>
          </button>
        </div>

        <button class="btn-continue hidden" id="btnContinueQ4">
          <span>Continuar</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- Pregunta 1.5: Motivación -->
    <section class="form-screen" data-screen="q1-5" data-phase="1">
      <div class="screen-content">
        <h2 class="question-title">¿Qué te motivó a buscar una solución?</h2>
        <p class="question-hint">Puedes seleccionar varias opciones</p>

        <div class="options-list multi-select" data-question="motivation" data-multi="true">
          <button class="option-btn" data-value="no_visibility">
            <span class="option-checkbox"></span>
            <span class="option-text">No tengo visibilidad de lo que pasa</span>
          </button>
          <button class="option-btn" data-value="no_adoption">
            <span class="option-checkbox"></span>
            <span class="option-text">El equipo no registra la información</span>
          </button>
          <button class="option-btn" data-value="losing_sales">
            <span class="option-checkbox"></span>
            <span class="option-text">Pierdo ventas o clientes</span>
          </button>
          <button class="option-btn" data-value="compliance">
            <span class="option-checkbox"></span>
            <span class="option-text">Problemas con auditorías o regulación</span>
          </button>
          <button class="option-btn" data-value="system_fails">
            <span class="option-checkbox"></span>
            <span class="option-text">El sistema actual no funciona</span>
          </button>
          <button class="option-btn" data-value="growth">
            <span class="option-checkbox"></span>
            <span class="option-text">Quiero crecer y necesito orden</span>
          </button>
        </div>

        <button class="btn-continue hidden" id="btnContinueQ5">
          <span>Continuar</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- Pregunta 1.6: Calidad de datos de clientes (Categoría B-CALIDAD) -->
    <section class="form-screen" data-screen="q1-6" data-phase="1">
      <div class="screen-content">
        <h2 class="question-title">¿Qué tan actualizada está tu base de clientes?</h2>
        <p class="question-hint">Datos de contacto, historial de compras, etc.</p>

        <div class="options-list" data-question="data_quality">
          <button class="option-btn" data-value="updated">
            <span class="option-key">A</span>
            <span class="option-text">Muy actualizada, tenemos proceso</span>
          </button>
          <button class="option-btn" data-value="somewhat">
            <span class="option-key">B</span>
            <span class="option-text">Más o menos, hay datos viejos</span>
          </button>
          <button class="option-btn" data-value="outdated">
            <span class="option-key">C</span>
            <span class="option-text">Bastante desactualizada</span>
          </button>
          <button class="option-btn" data-value="unknown">
            <span class="option-key">D</span>
            <span class="option-text">No sé, nadie lo revisa</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Pregunta 1.7: Pipeline de ventas (Categoría D) - MULTI-SELECT -->
    <section class="form-screen" data-screen="q1-7" data-phase="1">
      <div class="screen-content">
        <h2 class="question-title">¿Cómo llevas el seguimiento de oportunidades de venta?</h2>
        <p class="question-hint">Puedes seleccionar varias opciones</p>

        <div class="options-list multi-select" data-question="sales_pipeline" data-multi="true">
          <button class="option-btn" data-value="system">
            <span class="option-checkbox"></span>
            <span class="option-text">Pipeline en sistema/CRM</span>
          </button>
          <button class="option-btn" data-value="excel">
            <span class="option-checkbox"></span>
            <span class="option-text">En Excel o Google Sheets</span>
          </button>
          <button class="option-btn" data-value="per_seller">
            <span class="option-checkbox"></span>
            <span class="option-text">Cada vendedor lleva lo suyo</span>
          </button>
          <button class="option-btn" data-value="memory">
            <span class="option-checkbox"></span>
            <span class="option-text">En la cabeza del vendedor</span>
          </button>
          <button class="option-btn" data-value="none">
            <span class="option-checkbox"></span>
            <span class="option-text">No llevamos seguimiento formal</span>
          </button>
        </div>

        <button class="btn-continue hidden" id="btnContinueQ7">
          <span>Continuar</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- Pregunta 1.8: Cobranza (Categoría E) -->
    <section class="form-screen" data-screen="q1-8" data-phase="1">
      <div class="screen-content">
        <h2 class="question-title">¿Vendes a crédito?</h2>
        <p class="question-hint">Facturas con plazo de pago</p>

        <div class="options-list" data-question="sells_credit">
          <button class="option-btn" data-value="yes_controlled">
            <span class="option-key">A</span>
            <span class="option-text">Sí, y tenemos buen control</span>
          </button>
          <button class="option-btn" data-value="yes_some_overdue">
            <span class="option-key">B</span>
            <span class="option-text">Sí, pero hay facturas vencidas</span>
          </button>
          <button class="option-btn" data-value="yes_problem">
            <span class="option-key">C</span>
            <span class="option-text">Sí, y es un problema frecuente</span>
          </button>
          <button class="option-btn" data-value="no_cash">
            <span class="option-key">D</span>
            <span class="option-text">No, todo es de contado</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Pregunta 1.9: Reportes (Categoría F) -->
    <section class="form-screen" data-screen="q1-9" data-phase="1">
      <div class="screen-content">
        <h2 class="question-title">¿Cuánto tardas en generar un reporte para dirección?</h2>
        <p class="question-hint">Reporte de ventas, visitas, resultados del mes</p>

        <div class="options-list" data-question="report_time">
          <button class="option-btn" data-value="minutes">
            <span class="option-key">A</span>
            <span class="option-text">Minutos (tengo dashboards)</span>
          </button>
          <button class="option-btn" data-value="hours">
            <span class="option-key">B</span>
            <span class="option-text">Horas (busco y armo datos)</span>
          </button>
          <button class="option-btn" data-value="days">
            <span class="option-key">C</span>
            <span class="option-text">Días (armo todo en Excel)</span>
          </button>
          <button class="option-btn" data-value="none">
            <span class="option-key">D</span>
            <span class="option-text">No genero reportes formales</span>
          </button>
        </div>
      </div>
    </section>

    <!-- ==================== TRANSICIÓN A FASE 2: SITUACIONES ==================== -->
    <section class="form-screen" data-screen="transition-phase2">
      <div class="screen-content">
        <div class="transition-icon">
          <div class="loading-dots">
            <span></span><span></span><span></span>
          </div>
        </div>
        <h2 class="transition-title">Analizando tu contexto...</h2>
        <p class="transition-subtitle">Preparando situaciones relevantes para ti</p>
      </div>
    </section>

    <!-- ==================== SELECCIÓN DE TIPO DE NEGOCIO ==================== -->
    <section class="form-screen" data-screen="tipo-negocio">
      <div class="screen-content">
        <h2 class="question-title">¿Qué tipo de negocio tienes?</h2>
        <p class="question-hint">Esto nos permite mostrarte las situaciones más relevantes para ti</p>

        <div class="tipo-negocio-grid">
          <button class="tipo-negocio-btn" data-tipo="distribuidor">
            <div class="tipo-negocio-btn__icon"><i class="ph ph-truck"></i></div>
            <h3 class="tipo-negocio-btn__title">Distribuidor</h3>
            <p class="tipo-negocio-btn__desc">Distribuidora farmacéutica o de dispositivos médicos con equipo de campo</p>
          </button>
          <button class="tipo-negocio-btn" data-tipo="clinica">
            <div class="tipo-negocio-btn__icon"><i class="ph ph-first-aid-kit"></i></div>
            <h3 class="tipo-negocio-btn__title">Clínica</h3>
            <p class="tipo-negocio-btn__desc">Clínica médica, estética, dental u otro centro de salud</p>
          </button>
        </div>
      </div>
    </section>

    <!-- ==================== FASE 2A: SWIPE CARDS (16 situaciones) ==================== -->
    <section class="form-screen" data-screen="swipe-situaciones" data-phase="2">
      <div class="screen-content screen-content--wide">
        <div class="swipe-header">
          <div class="swipe-progress">
            <span id="swipeCounter">1</span> / <span id="swipeTotal">16</span>
          </div>
          <h2 class="swipe-title">¿Esta situación te afecta?</h2>
          <p class="swipe-hint">Desliza a la derecha si te identificas, a la izquierda si no aplica</p>
        </div>

        <div class="swipe-container" id="swipeContainer">
          <div class="swipe-stack" id="swipeStack">
            <!-- Carta 3 (fondo) -->
            <div class="swipe-card swipe-card--stack-2" id="swipeCard2">
              <div class="swipe-card__icon"></div>
              <h3 class="swipe-card__title"></h3>
              <p class="swipe-card__description"></p>
            </div>
            <!-- Carta 2 (medio) -->
            <div class="swipe-card swipe-card--stack-1" id="swipeCard1">
              <div class="swipe-card__icon"></div>
              <h3 class="swipe-card__title"></h3>
              <p class="swipe-card__description"></p>
            </div>
            <!-- Carta 1 (activa/top) -->
            <div class="swipe-card swipe-card--active" id="swipeCard">
              <div class="swipe-card__icon" id="swipeCardIcon"></div>
              <h3 class="swipe-card__title" id="swipeCardTitle">Cargando...</h3>
              <p class="swipe-card__description" id="swipeCardDescription">...</p>
              <div class="swipe-card__indicator swipe-card__indicator--left">
                <span>No aplica</span>
              </div>
              <div class="swipe-card__indicator swipe-card__indicator--right">
                <span>Me afecta</span>
              </div>
            </div>
          </div>
        </div>

        <div class="swipe-actions">
          <button class="swipe-btn swipe-btn--no" id="btnSwipeNo" title="No me afecta">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
          <button class="swipe-btn swipe-btn--yes" id="btnSwipeYes" title="Sí me afecta">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 6L9 17l-5-5"/>
            </svg>
          </button>
        </div>

        <div class="swipe-legend">
          <div class="swipe-legend__item">
            <kbd>←</kbd> No aplica
          </div>
          <div class="swipe-legend__item">
            <kbd>→</kbd> Me afecta
          </div>
        </div>
      </div>
    </section>

    <!-- ==================== TRANSICIÓN A PRIORIZACIÓN ==================== -->
    <section class="form-screen" data-screen="transition-maxdiff">
      <div class="screen-content">
        <div class="transition-icon">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="var(--tech-cyan)" stroke-width="2">
            <path d="M3 3v18h18"/>
            <path d="M18 17V9"/>
            <path d="M13 17V5"/>
            <path d="M8 17v-3"/>
          </svg>
        </div>
        <h2 class="transition-title">Ahora vamos a priorizar</h2>
        <p class="transition-subtitle">
          Seleccionaste <strong id="situacionesCount">6</strong> situaciones.<br>
          Toca cada tarjeta en orden de importancia.
        </p>
      </div>
    </section>

    <!-- ==================== FASE 2B: PRIORIZACIÓN POR TOQUE ==================== -->
    <section class="form-screen" data-screen="maxdiff-priorizar" data-phase="2">
      <div class="screen-content screen-content--wide">
        <div class="rank-header">
          <h2 class="rank-title">Toca en orden de prioridad</h2>
          <p class="rank-hint">1 = lo que más te afecta. Toca para deshacer.</p>
          <div class="rank-progress">
            <span id="rankCount">0</span> / <span id="rankTotal">0</span> ordenadas
          </div>
        </div>

        <div class="rank-grid" id="rankGrid">
          <!-- Se generan las tarjetas dinámicamente -->
        </div>

        <button class="btn-primary rank-continue hidden" id="btnRankContinue">
          <span>Continuar</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- ==================== RESULTADO: TOP 4 SITUACIONES ==================== -->
    <section class="form-screen" data-screen="top4-resultado" data-phase="2">
      <div class="screen-content screen-content--wide">
        <h2 class="top4-title">Tus 4 situaciones prioritarias</h2>
        <p class="top4-subtitle">Estas son las áreas donde APEX te ayudará primero</p>

        <div class="top4-list" id="top4List">
          <!-- Se generan las 4 cards dinámicamente -->
        </div>

        <button class="btn-primary" id="btnContinueTop4">
          <span>Continuar</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- ==================== TRANSICIÓN A PROFUNDIZACIÓN ==================== -->
    <section class="form-screen" data-screen="transition-phase2-questions">
      <div class="screen-content">
        <div class="transition-icon">
          <div class="loading-dots">
            <span></span><span></span><span></span>
          </div>
        </div>
        <h2 class="transition-title">Analizando tus prioridades...</h2>
        <p class="transition-subtitle">Preparando preguntas para entender mejor tu situación</p>
      </div>
    </section>

    <!-- ==================== FASE 2C: PREGUNTAS ADAPTATIVAS (basadas en top 4) ==================== -->
    <section class="form-screen" data-screen="phase2-questions" data-phase="2">
      <div class="screen-content">
        <div class="progress-pills" id="adaptiveProgressPills">
          <!-- Se generan dinámicamente -->
        </div>
        <h2 class="question-title" id="adaptiveQuestionTitle">Cargando pregunta...</h2>
        <p class="question-hint" id="adaptiveQuestionHint"></p>

        <div class="options-list" id="adaptiveOptions" data-question="adaptive">
          <!-- Las opciones se generan dinámicamente -->
        </div>
      </div>
    </section>

    <!-- ==================== TRANSICIÓN A FASE 3 ==================== -->
    <section class="form-screen" data-screen="transition-phase3">
      <div class="screen-content">
        <div class="transition-icon">
          <div class="loading-brain">
            <svg viewBox="0 0 60 60" fill="none">
              <circle cx="30" cy="30" r="28" stroke="currentColor" stroke-width="2" opacity="0.3"/>
              <path class="brain-path" d="M20 35c0-8 5-15 10-15s10 7 10 15" stroke="currentColor" stroke-width="2" fill="none"/>
            </svg>
          </div>
        </div>
        <h2 class="transition-title">Detectando tus dolores...</h2>
        <p class="transition-subtitle">Analizando las respuestas con IA</p>
      </div>
    </section>

    <!-- ==================== FASE 3: PAINS DETECTADOS (CONFIRMAR UNO POR UNO) ==================== -->
    <section class="form-screen" data-screen="pains-detected" data-phase="3">
      <div class="screen-content screen-content--wide">
        <h2 class="pains-title">Este es el principio del cambio</h2>
        <h1 class="pains-highlight" id="painsHighlight">TUS REALIDADES ACTUALES A CAMBIAR</h1>
        <p class="pains-instruction">Revisa cada realidad: acepta, matiza o rechaza</p>

        <div class="pains-list" id="painsList">
          <!-- Se generan dinámicamente en renderDetectedPains -->
        </div>

        <!-- Custom pains: agregar problemas propios -->
        <div class="custom-pains-section" id="customPainsSection">
          <div class="custom-pains-divider">
            <span class="custom-pains-divider-line"></span>
            <span class="custom-pains-divider-text">Agrega tus propias realidades a cambiar</span>
            <span class="custom-pains-divider-line"></span>
          </div>

          <div class="custom-pains-list" id="customPainsList">
            <!-- Se generan dinámicamente -->
          </div>

          <div class="custom-pain-input-area" id="customPainInputArea">
            <textarea
              class="custom-pain-textarea"
              id="customPainText"
              placeholder="Describe una realidad que no hayamos mencionado..."
              rows="2"
              maxlength="500"
            ></textarea>
            <div class="custom-pain-input-actions">
              <button class="custom-pain-record-btn" id="customPainRecordBtn" title="Grabar audio">
                <i class="ph ph-microphone"></i>
              </button>
              <button class="custom-pain-add-btn" id="customPainAddBtn" disabled title="Agregar realidad">
                <i class="ph ph-plus"></i>
                <span>Agregar</span>
              </button>
            </div>
            <div class="custom-pain-recorder hidden" id="customPainRecorder">
              <div class="pain-recorder-controls">
                <button class="pain-recorder-btn" id="customPainRecBtn">
                  <span class="pain-recorder-icon--record">&#9679;</span>
                  <span class="pain-recorder-icon--stop hidden">&#9632;</span>
                </button>
                <span class="pain-recorder-timer" id="customPainTimer">0:00</span>
                <span class="pain-recorder-status" id="customPainRecStatus">Toca para grabar</span>
              </div>
              <div class="custom-pain-transcription hidden" id="customPainTranscription">
                <p class="pain-transcription-label">Lo que dijiste:</p>
                <p class="pain-transcription-text" id="customPainTranscText"></p>
              </div>
            </div>
          </div>
        </div>

        <div class="pains-continue">
          <button class="btn-primary btn-continue-pains hidden" id="btnContinuePains">
            <span>Continuar</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </button>
          <p class="pains-continue-hint" id="painsContinueHint">Responde a cada realidad para continuar</p>
        </div>
      </div>
    </section>

    <!-- ==================== FASE 4: AUDIO ==================== -->
    <section class="form-screen" data-screen="audio-record" data-phase="4">
      <div class="screen-content">
        <div class="audio-icon">
          <svg viewBox="0 0 80 80" fill="none">
            <circle cx="40" cy="40" r="38" stroke="currentColor" stroke-width="2" opacity="0.3"/>
            <rect x="30" y="20" width="20" height="35" rx="10" stroke="currentColor" stroke-width="2"/>
            <path d="M25 40v5a15 15 0 0030 0v-5" stroke="currentColor" stroke-width="2"/>
            <line x1="40" y1="60" x2="40" y2="70" stroke="currentColor" stroke-width="2"/>
            <line x1="32" y1="70" x2="48" y2="70" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>

        <h2 class="audio-title" id="audioTitle">Ahora cuéntanos más con tus palabras</h2>
        <p class="audio-subtitle" id="audioSubtitle">
          Graba un audio de 1-2 minutos explicando:
        </p>

        <ul class="audio-prompts" id="audioPrompts">
          <li>¿Cuál de estos 4 dolores te afecta MÁS?</li>
          <li>¿Qué has intentado hacer para resolverlo?</li>
          <li>¿Hay algo más que debamos saber?</li>
        </ul>

        <div class="audio-recorder" id="audioRecorder">
          <div class="recorder-visualizer" id="recorderVisualizer">
            <div class="visualizer-bars">
              <span></span><span></span><span></span><span></span><span></span>
              <span></span><span></span><span></span><span></span><span></span>
            </div>
          </div>

          <div class="recorder-timer" id="recorderTimer">0:00</div>

          <button class="recorder-btn" id="recorderBtn">
            <span class="recorder-btn__record">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="8"/>
              </svg>
            </span>
            <span class="recorder-btn__stop hidden">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <rect x="6" y="6" width="12" height="12" rx="2"/>
              </svg>
            </span>
          </button>

          <p class="recorder-status" id="recorderStatus">Toca para grabar</p>
        </div>

        <div class="audio-preview hidden" id="audioPreview">
          <audio id="audioPlayer" controls></audio>
          <div class="audio-preview-actions">
            <button class="btn-rerecord" id="btnRerecord">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 4v6h6M23 20v-6h-6"/>
                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
              </svg>
              <span>Grabar de nuevo</span>
            </button>
            <button class="btn-primary btn-use-audio" id="btnUseAudio">
              <span>Usar este audio</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </button>
          </div>
        </div>

        <p class="audio-note">
          El audio nos ayuda a preparar una propuesta más personalizada para ti.
        </p>
      </div>
    </section>

    <!-- ==================== TRANSICIÓN: PROCESANDO AUDIO ==================== -->
    <section class="form-screen" data-screen="processing-audio">
      <div class="screen-content">
        <div class="transition-icon">
          <div class="loading-wave">
            <span></span><span></span><span></span><span></span><span></span>
          </div>
        </div>
        <h2 class="transition-title">Procesando tu audio...</h2>
        <p class="transition-subtitle">Transcribiendo y analizando</p>
      </div>
    </section>

    <!-- ==================== FASE 5: CONFIRMACIÓN FINAL ==================== -->
    <section class="form-screen" data-screen="final-pains" data-phase="5">
      <div class="screen-content screen-content--wide">
        <h2 class="final-title">Tus 4 realidades que vamos a transformar:</h2>

        <div class="final-pains-list" id="finalPainsList">
          <!-- Se generan dinámicamente -->
        </div>

        <button class="btn-primary" id="btnContinueFinalPains" style="margin-top:var(--spacing-lg)">
          <span>Continuar</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- ==================== DATOS DE USO: PANTALLA 1 - EQUIPO ==================== -->
    <section class="form-screen" data-screen="du-1" data-phase="5">
      <div class="screen-content">
        <h2 class="question-title">¿Cuántas personas usarán el sistema?</h2>
        <p class="question-hint">Incluye a todos los que necesitarán acceso</p>

        <div class="options-list" data-question="du_team_size">
          <button class="option-btn" data-value="1-3">
            <span class="option-key">A</span>
            <span class="option-text">1-3 personas</span>
          </button>
          <button class="option-btn" data-value="4-10">
            <span class="option-key">B</span>
            <span class="option-text">4-10 personas</span>
          </button>
          <button class="option-btn" data-value="11-25">
            <span class="option-key">C</span>
            <span class="option-text">11-25 personas</span>
          </button>
          <button class="option-btn" data-value="26-50">
            <span class="option-key">D</span>
            <span class="option-text">26-50 personas</span>
          </button>
          <button class="option-btn" data-value="50+">
            <span class="option-key">E</span>
            <span class="option-text">Más de 50 personas</span>
          </button>
        </div>
      </div>
    </section>

    <!-- ==================== DATOS DE USO: PANTALLA 2 - ROLES (dinámico según tipo negocio) ==================== -->
    <section class="form-screen" data-screen="du-2" data-phase="5">
      <div class="screen-content">
        <h2 class="question-title">¿Quiénes usarán el sistema?</h2>
        <p class="question-hint">Selecciona todos los perfiles que apliquen</p>

        <div class="options-list multi-select" id="duRolesOptions" data-question="du_roles" data-multi="true">
          <!-- Se generan dinámicamente en JS según tipo de negocio -->
        </div>

        <button class="btn-continue hidden" id="btnContinueDuRoles">
          <span>Continuar</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- ==================== DATOS DE USO: PANTALLA 3 - SISTEMA ACTUAL (condicional) ==================== -->
    <section class="form-screen" data-screen="du-3" data-phase="5">
      <div class="screen-content">
        <h2 class="question-title">¿Qué sistema de gestión usas actualmente?</h2>
        <p class="question-hint">Escribe el nombre de tu CRM, ERP o herramienta principal</p>

        <div class="du-input-wrapper">
          <input type="text" class="datos-uso-input" id="duSistemaActual" placeholder="ej: Salesforce, SAP, Zoho, HubSpot...">
          <button class="btn-primary du-input-continue" id="btnContinueDuSistema" disabled>
            <span>Continuar</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
      </div>
    </section>

    <!-- ==================== DATOS DE USO: PANTALLA 4 - TIMELINE ==================== -->
    <section class="form-screen" data-screen="du-4" data-phase="5">
      <div class="screen-content">
        <h2 class="question-title">¿Cuándo necesitas tener el sistema funcionando?</h2>

        <div class="options-list" data-question="du_timeline">
          <button class="option-btn" data-value="urgente">
            <span class="option-key">A</span>
            <span class="option-text">Lo antes posible (urgente)</span>
          </button>
          <button class="option-btn" data-value="1-3meses">
            <span class="option-key">B</span>
            <span class="option-text">En los próximos 1-3 meses</span>
          </button>
          <button class="option-btn" data-value="3-6meses">
            <span class="option-key">C</span>
            <span class="option-text">En 3-6 meses</span>
          </button>
          <button class="option-btn" data-value="explorando">
            <span class="option-key">D</span>
            <span class="option-text">Solo estoy explorando opciones</span>
          </button>
        </div>
      </div>
    </section>

    <!-- ==================== DATOS DE CONTACTO ==================== -->
    <section class="form-screen" data-screen="contact-info" data-phase="5">
      <div class="screen-content">
        <h2 class="contact-title">Para enviarte la propuesta:</h2>

        <form class="contact-form" id="contactForm">
          <div class="form-field">
            <label for="contactName">Nombre y Apellidos</label>
            <input type="text" id="contactName" name="name" required placeholder="Tu nombre y apellidos">
          </div>

          <div class="form-field">
            <label for="contactEmail">Email</label>
            <input type="email" id="contactEmail" name="email" required placeholder="tu@email.com">
          </div>

          <div class="form-field">
            <label for="contactWhatsapp">WhatsApp</label>
            <input type="tel" id="contactWhatsapp" name="whatsapp" required placeholder="+52 55 1234 5678">
          </div>

          <button type="submit" class="btn-primary btn-submit">
            <span>Enviar propuesta</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
            </svg>
          </button>
        </form>
      </div>
    </section>

    <!-- ==================== PANTALLA DE GRACIAS ==================== -->
    <section class="form-screen" data-screen="thank-you">
      <div class="screen-content">
        <div class="thanks-icon">
          <svg viewBox="0 0 80 80" fill="none">
            <circle cx="40" cy="40" r="38" stroke="currentColor" stroke-width="2"/>
            <path d="M25 42l10 10 20-24" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>

        <h1 class="thanks-title">¡Gracias, <span id="thanksName">amigo</span>!</h1>

        <div class="thanks-info">
          <p>En las próximas <strong>48 horas</strong> recibirás una propuesta personalizada.</p>
        </div>

        <div class="thanks-summary">
          <h3>La propuesta incluirá:</h3>
          <ul>
            <li>
              <strong>CUERPO COMPLETO</strong> de cada realidad
              <span>(todo lo que se puede hacer)</span>
            </li>
            <li>
              <strong>ALCANCE INICIAL</strong>
              <span>(qué construimos con los 2,500€)</span>
            </li>
            <li>
              <strong>SUSCRIPCIÓN</strong> según tus necesidades
              <span>Base (9€), Esencial (19€) o Pro (29€) por usuario</span>
            </li>
          </ul>
        </div>

        <div class="thanks-contact">
          <p>¿Dudas? Escríbenos:</p>
          <a href="mailto:info@prismaconsul.com" class="contact-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
              <polyline points="22,6 12,13 2,6"/>
            </svg>
            info@prismaconsul.com
          </a>
          <a href="https://wa.me/34635855915" class="contact-link" target="_blank">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
            </svg>
            +34 635 855 915
          </a>
        </div>

        <a href="../" class="btn-back-home">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          <span>Volver a PRISMA Consul</span>
        </a>
      </div>
    </section>

  </main>

  <!-- Navigation Buttons (Fixed) -->
  <nav class="form-nav hidden" id="formNav">
    <button class="nav-btn nav-btn--prev" id="btnPrev">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
    </button>
    <div class="nav-progress" style="display:none">
      <span id="navCurrent">1</span> / <span id="navTotal">5</span>
    </div>
    <button class="nav-btn nav-btn--next hidden" id="btnNext">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M5 12h14M12 5l7 7-7 7"/>
      </svg>
    </button>
  </nav>

  <!-- Scripts -->
  <!-- pain-knowledge-base.js movida al servidor (netlify/functions) para seguridad -->
  <script src="signal-detector.js"></script>
  <script src="form.js"></script>
</body>
</html>
